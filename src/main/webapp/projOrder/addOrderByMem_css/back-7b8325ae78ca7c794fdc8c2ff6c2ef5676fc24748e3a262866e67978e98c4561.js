function selectCities(){var e=q(".js-country-select");if(e.value!==initialCountry){e.dispatchEvent(new Event("change",{bubbles:!0}));var t=q('[data-country="'+e.value+'"] .js-city-select');t&&t.value&&t.dispatchEvent(new Event("change",{bubbles:!0}))}}function variationsChosen(){var e;return each(".js-product-variation",function(t){e||t.value||(e=t)}),!e||(e.classList.add("red","ba"),e.focus(),e.addEventListener("change",function(){e.classList.remove("red","ba")},{once:!0}),!1)}function showOptionDetails(){q(".js-show-payment-details").classList.toggle("dn"),q(".js-show-option-details").classList.toggle("dn"),q(".js-payment-step").classList.add("dn"),q(".js-option-details").classList.remove("dn"),q(".js-payment-step-required").checked=!1}function showPaymentDetails(){q(".js-show-option-details").classList.toggle("dn"),q(".js-show-payment-details").classList.toggle("dn"),q(".js-payment-step").classList.remove("dn"),q(".js-option-details").classList.add("dn"),q(".js-payment-step-required").checked=!0}function reloadVariations(){var e=map(".js-option-as-addon:checked",function(e){return e.getAttribute("data-ids")}).filter(function(e){return!!e}),t=q(".js-variations-fragment"),s=t.getAttribute("data-src"),a=q(".js-variation-selection");e.length>0&&(a.hidden=!1,s=s+"?product_ids="+e.join(",")),t.src=s,lastVarRequest=t.src}function updateSum(){var e=q(".js-update-sum");e&&(e.form.action=e.getAttribute("formaction"),e.form.setAttribute("data-remote",!0),e.click())}var initialCountry=q(".js-country-select").value;window.addEventListener("pageshow",selectCities),selectCities(),on("change",".js-country-select",function(e,t){var s="TW"===t.value||"TWI"===t.value;each(".js-city-select",function(e){e.name="_city",e.value="",e.required=!1}),each(".js-district-select",function(e){e.name="_district",e.value="",e.required=!1}),each("[data-country]",function(e){var a=s&&e.getAttribute("data-country")==t.value,i=q(".js-city-select",e);e.hidden=!a,i.name=a?"city":"_city",i.required=a,each(".js-district",function(e){e.hidden=!0}),a&&i.focus()}),q(".js-postcode-field").value=""}),on("change",".js-city-select",function(e,t){if(each(".js-district",function(e){e.hidden=!0;var t=q(".js-district-select",e);t.name="_district",t.required=!1,t.value=""}),group=q('[data-city="'+t.value+'"][data-for="'+q(".js-country-select").value+'"]'),group){group.hidden=!1;var s=q(".js-district-select",group);s.name="district",s.focus(),s.required=!0}}),on("change",".js-district-select",function(e,t){var s=JSON.parse(t.getAttribute("data-json"));q(".js-postcode-field").value=s[t.value]||""}),on("change",".js-payment-method",function(e,t){var s=q(".js-atm-warning");s&&s.classList.toggle("dn",!("atm"===t.value&&t.checked));var a=q(".js-zero-card-warning");a&&a.classList.toggle("dn",!("zero_card"===t.value&&t.checked));var i=q(".js-credit-card-warning");a&&i.classList.toggle("dn",!("credit_card"===t.value&&t.checked));var n="zero_card"===t.value&&t.checked,o=q(".js-zero-card-section");o&&(o.classList.toggle("dn",!n),each(".js-zero-card-input",function(e){e.required=n,e.disabled=!n}))},!0),on("click",".js-show-payment-details",function(){variationsChosen()&&showPaymentDetails()}),on("click",".js-show-option-details",function(){showOptionDetails()}),on("change",".js-option-as-addon",reloadVariations);var lastVarRequest=null;on("include-fragment-to-replace",".js-variations-fragment",function(e){lastVarRequest&&lastVarRequest!==e.detail.url&&e.preventDefault()});var lastSumXHR=null;on("ajax:before",".js-previewable-sum",function(e){q(".js-submit-order").disabled=!0,q(".js-sum-input").value=0,q(".js-preview-sum").classList.add("o-50"),lastSumXHR&&e.detail!==lastSumXHR&&lastSumXHR.abort(),lastSumXHR=e.detail}),on("ajax:complete",".js-previewable-sum",function(e,t){if((!lastSumXHR||e.detail===lastSumXHR)&&(lastSumXHR=null,q(".js-submit-order").disabled=!1,q(".js-preview-sum").classList.remove("o-50"),t.removeAttribute("data-remote",!0),t.action=t.getAttribute("data-submit-path"),200===e.detail.status)){var s=JSON.parse(e.detail.response);q(".js-preview-sum").innerHTML=s.html,q(".js-sum-input").value=s.sum,q(".js-sum").textContent=s.sum.toLocaleString()}}),on("change",".js-option-as-addon, .js-product-variation, .js-update-sum-for-postage, .js-extra, .js-coupon_code",updateSum),window.addEventListener("pageshow",updateSum),updateSum(),on("submit","form#new_order",function(){q(".js-submit-order").disabled=!0});